<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agent Login | Mumbai Realty</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="../css/style.css" />
  <style>
    .login-bg-art {
      position: absolute; inset: 0;
      background-image: url('https://images.unsplash.com/photo-1570168007204-dfb528c6958f?w=1200&q=70');
      background-size: cover; background-position: center;
      opacity: 0.08;
    }
    .login-wrap { position: relative; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 24px; }
    .input-icon { position: relative; }
    .input-icon i.field-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #888; z-index: 2; }
    .input-icon input { padding-left: 40px; }
    .toggle-pw { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #888; z-index: 2; }

    /* Fallback styles in case style.css doesn't load */
    body { background: #f4f6fa; font-family: 'DM Sans', sans-serif; }
    .login-card {
      background: #fff;
      border-radius: 16px;
      padding: 40px 36px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.12);
    }
    .login-logo { font-size: 1.6rem; font-weight: 800; color: #0f172a; }
    .login-logo span { color: #0ea5e9; }
    .btn-navy {
      background: #0f172a;
      color: #fff;
      border: none;
      border-radius: 10px;
      transition: background 0.2s;
    }
    .btn-navy:hover { background: #1e293b; color: #fff; }
    .login-divider { display: flex; align-items: center; gap: 12px; margin: 20px 0; color: #888; font-size: 0.85rem; }
    .login-divider::before, .login-divider::after { content:''; flex:1; height:1px; background:#e2e8f0; }
    .page-loader {
      position: fixed; inset: 0; background: #fff;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 9999; transition: opacity 0.5s;
    }
    .page-loader.hidden { opacity: 0; pointer-events: none; }
    .loader-logo { font-size: 1.8rem; font-weight: 800; color: #0f172a; margin-bottom: 16px; }
    .loader-logo span { color: #0ea5e9; }
    .loader-ring {
      width: 40px; height: 40px; border: 3px solid #e2e8f0;
      border-top-color: #0ea5e9; border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

<!-- Page Loader -->
<div class="page-loader" id="pageLoader">
  <div class="loader-logo">Mumbai <span>Realty</span></div>
  <div class="loader-ring"></div>
</div>

<div class="login-wrap">
  <div class="login-bg-art"></div>
  <div class="login-card">

    <!-- Logo -->
    <div class="text-center mb-4">
      <div class="login-logo"><i class="fas fa-building me-2" style="color:#0ea5e9;"></i>Mumbai <span>Realty</span></div>
      <p class="text-muted mt-1" style="font-size:0.88rem;">Agent Login — Authorized Access Only</p>
    </div>

    <!-- Badge -->
    <div class="text-center mb-4">
      <span style="background:#f8fafc;border:1.5px solid #e2e8f0;color:#0f172a;padding:6px 16px;border-radius:20px;font-size:0.8rem;font-weight:600;">
        <i class="fas fa-lock me-1" style="color:#0ea5e9;"></i> Secure Agent Portal
      </span>
    </div>

    <!-- Form -->
    <form id="loginForm" novalidate>
      <div class="mb-3">
        <label class="form-label fw-semibold">Email Address</label>
        <div class="input-icon">
          <i class="fas fa-envelope field-icon"></i>
          <input type="email" class="form-control" id="loginEmail"
                 placeholder="agent@example.com" required autocomplete="email" />
        </div>
      </div>

      <div class="mb-4">
        <label class="form-label fw-semibold">Password</label>
        <div class="input-icon" style="position:relative;">
          <i class="fas fa-lock field-icon"></i>
          <input type="password" class="form-control" id="loginPassword"
                 placeholder="Enter password" required autocomplete="current-password"
                 style="padding-left:40px;padding-right:44px;" />
          <i class="fas fa-eye toggle-pw" id="togglePw" onclick="togglePassword()"></i>
        </div>
      </div>

      <!-- Error message -->
      <div id="loginError" class="alert alert-danger d-none py-2 mb-3" style="font-size:0.875rem;border-radius:8px;"></div>

      <button type="submit" class="btn btn-navy w-100 py-3 fw-bold fs-6" id="loginBtn">
        <i class="fas fa-sign-in-alt me-2"></i>Login to Dashboard
      </button>
    </form>

    <div class="login-divider">Only authorized agent can login</div>

    <div class="text-center">
      <a href="../index.html" class="btn btn-outline-secondary w-100 py-2">
        <i class="fas fa-arrow-left me-2"></i>Back to Website
      </a>
    </div>

    <p class="text-center text-muted mt-4 mb-0" style="font-size:0.78rem;">
      Public registration is disabled.<br>Contact admin if you need access.
    </p>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // ✅ Firebase config — directly in this file (no external dependency)
  const firebaseConfig = {
    apiKey: "AIzaSyAfbx0WlUPJ0elur2l09GXZfi0j2jVoGuM",
    authDomain: "mumbai-realty.firebaseapp.com",
    projectId: "mumbai-realty",
    storageBucket: "mumbai-realty.firebasestorage.app",
    messagingSenderId: "806144133947",
    appId: "1:806144133947:web:541f7a32084f815da7c51e"
  };

  const AGENT_EMAIL = "swapnilgorule93@gmail.com";

  // Initialize Firebase
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();

  // ✅ Hide loader
  function hideLoader() {
    const l = document.getElementById('pageLoader');
    if (l) { l.classList.add('hidden'); setTimeout(() => l.remove(), 500); }
  }

  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(hideLoader, 600);

    // Already logged in? Go to dashboard
    auth.onAuthStateChanged(user => {
      if (user && user.email === AGENT_EMAIL) {
        window.location.href = 'dashboard.html';
      }
    });
  });

  // ✅ Login form submit
  document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const btn   = document.getElementById('loginBtn');
    const err   = document.getElementById('loginError');
    const email = document.getElementById('loginEmail').value.trim();
    const pass  = document.getElementById('loginPassword').value;

    err.classList.add('d-none');
    err.textContent = '';

    // Block non-agent emails
    if (email.toLowerCase() !== AGENT_EMAIL.toLowerCase()) {
      err.textContent = 'Access denied. Only the authorized agent can login.';
      err.classList.remove('d-none');
      return;
    }

    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Logging in…';

    try {
      await auth.signInWithEmailAndPassword(email, pass);
      window.location.href = 'dashboard.html';
    } catch (error) {
      console.error('Login error:', error.code, error.message);
      let msg = 'Login failed. Please try again.';
      if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
        msg = 'Incorrect password. Please try again.';
      } else if (error.code === 'auth/user-not-found') {
        msg = 'Account not found. Please check your email.';
      } else if (error.code === 'auth/too-many-requests') {
        msg = 'Too many attempts. Please try again later.';
      } else if (error.code === 'auth/network-request-failed') {
        msg = 'Network error. Please check your internet connection.';
      } else {
        msg = error.message; // Show actual error for debugging
      }
      err.textContent = msg;
      err.classList.remove('d-none');
    } finally {
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i>Login to Dashboard';
    }
  });

  // ✅ Toggle password visibility
  function togglePassword() {
    const inp = document.getElementById('loginPassword');
    const ico = document.getElementById('togglePw');
    if (inp.type === 'password') {
      inp.type = 'text';
      ico.className = 'fas fa-eye-slash toggle-pw';
    } else {
      inp.type = 'password';
      ico.className = 'fas fa-eye toggle-pw';
    }
  }
</script>
</body>
</html>